# Color-MMLs

В данном проекте предлагается исследовать цветовое пространство у нейросетевых моделей формата VLM - vision language model и сравнить с GT данными, полученными в результате психофизических испытаний с человеком. 

В качестве VLM модели в начале берём Qwen-2.5VL. Инструкцию по запуску можно найти по ссылке https://github.com/QwenLM/Qwen2.5-VL?ysclid=mdaeaktv2u49645692.

В качестве датасета с большими цветовыми расстояниями предлагается взять открытые данные Мансела (Munsell color system). Изначально система была разработана в 1940-м году. В её основу легло введение таких хорошо интерпретируемых терминов, как H (hue -- оттенок), C (croma -- насыщенность) и V (value -- яркость)). По результатам психофизических исследований были выбраны цепочки Мансела такие, что воспринимаемая разница между цветами одинакова. В отличие от пороговых измерений расстояния между цветами данный датасет позволяет сравнивать удаленные цвета.
Так например разница между парами цветов по munsell системе H=2.5R	C=1	V=8, H=2.5R	C=2	V=8 и H=2.5R	C=4	V=8 и H=2.5R	C=5	V=8 должна восприниматься одинаково.
Однако расстояние по С V и H лучше не сравнивать, однородность там скорее всего теряется. Стоит сравнивать только цепочки, где меняется только одно значения - H, С или V.
В изначальном датасете были множественные ошибки. Самую актуальную версию исправленного датасета можно найти по ссылке https://github.com/iitpvisionlab/mrr-revised  -- Munsel v3.2.

В таблице представлен перевод цветов из системы munsell в цветовые координаты xyY (search for cromaticity diagram). C помощью open-source библиотеки colour-scince цвета можно перевести из этой системы в какую угодно для отображения. Например: xyY -> XYZ -> sRGB -> clip[0,1] -> matplotlib.

# Описание задания 

- Взять Clip, а в идеале Vit используемого Qwen и сравнить эмбеддинги цветов из цепочек мансела - проверить одинаковые расстояния между векторами или нет. Предлагается взять угол между векторами и смотреть на дисперсию, чтобы оценить неодинаковость эмбеддингов цветов из цепочки. Конечный результат - сравнение отдельно по цепочкам H, C и V.
- Повторить аналогичный эксперимент с Qwen 7B или 30B. Здесь постановка эксперимента может быть разная. Предлагается задать промптом модель воспринимать цвета меньше основываясь на числах кодировки цвета и больше на её внутреннем представлении. Пример промпта будет ниже. Конечно чем больше модель, тем более богатым будет её внутренне представление и скорее тем ближе к человеческому, однако на сервере предлагается запустить ту модель, которая там запускается. Либо можно провести эксперимент с большой моделью по API Qwen. Эксперимент ставится следующим образом: предлагается представлять модели пары цветов из цепочки и нет и спрашивать, какие лежат ближе по разнице друг к другу. Постановка эксперимента может быть изменениа, с обоснованием.

Пример промпта:

Imagine you are a human with normal vision and typical color perception. You are presented with two colors, and your task is to intuitively feel the difference between them, not just in terms of numerical values (like RGB or HSV), but in an abstract, almost emotional sense. As you process these colors in your hidden layers, think about how they might evoke different sensations, moods, or associations. Based on this abstract feeling answer the folowing question: ...

# Возможная постановка эксперимента

### 1. Подготовка пар цветов

- Берутся цепочки цветов Мансела, где изменяется только один параметр: **H (оттенок), C (насыщенность) или V (яркость)**.
- Формируются **пары соседних цветов** в цепочке (например, `H=2.5R C=1 V=8` и `H=5R C=1 V=8`).
- Также формируются **контрольные пары** — цвета из разных цепочек, но с тем же числовым расстоянием по Munsell, но различными по восприятию.

### 2. Запрос к модели

Модели задаётся задача сравнения пар цветов с помощью промпта, например:

Пример 1 пары:

> **"You are a human with normal vision. Compare the following two pairs of colors and tell which pair looks more similar in terms of perceived color difference. Focus not on numbers, but on how different they feel to you."**

Пример:
```
Pair A: Color 1 - H=2.5R C=2 V=8, Color 2 - H=5R C=2 V=8  
Pair B: Color 1 - H=2.5R C=2 V=8, Color 2 - H=2.5R C=4 V=8  
Which pair looks more similar in terms of perceived difference?
```

Для 3-х и более цветов модель можно просить выстраивать их в ряд по схожести и затем сравниваться с Манселлом.

### 3. Повторение для множества пар

- Эксперимент повторяется для множества пар из разных цепочек.
- Можно использовать **баллы схожести** (например, вероятность выбора одной из пар) или попросить модель **ранжировать** несколько пар по степени различия.

---

# Валидация на Munsell

### 1. Сравнение с ground truth

- Известно, что в Munsell-цепочках **воспринимаемое расстояние между соседними цветами одинаково**.
- Если модель **правильно понимает перцептивные различия**, то:
  - Она должна считать **соседние цвета в одной цепочке** более похожими друг на друга, чем цвета из разных цепочек.
  - Она должна **сохранять пропорциональность** воспринимаемых различий (например, цвета на расстоянии 2 шага — вдвое "дальше", чем на расстоянии 1).

### 2. Анализ согласованности

- Считается **процент согласованных ответов** с Munsell GT.
- Можно использовать **метрики ранжирования** (например, **Spearman correlation** между предсказанными и реальными рангами различий).

## В экспериментах рекомендуется рассматривать цепочки по V - они наиболее перцптивно равномерны.

# Конечная цель
Конечной целью является получение способа провери текущего пространства эмбеддингов или представление VLM о цветах и их соответсвие перцептивной однородности на примере датасета munsell.

# Дополнительные материалы 

С дополнительными материалами по колориметрии можно ознакомится на записях лекций от Ершова Егора, нашего заведующего лабороторией.

https://disk.yandex.ru/d/Ke9peZ57RO5DDA
